<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Cellosoft Alt Framework : the Alternative web framework</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--Fireworks 8 Dreamweaver 8 target.  Created Sun Jun 11 16:05:11 GMT-0600 (Mountain Standard Time) 2006-->
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body bgcolor="#ffffff">
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href=""><img name="logo" src="http://images.cellosoft.com/marcello/projects/alt/logo.png" width="481" height="119" border="0" id="logo" alt="cellosoft Alt : the Alternative web framework" /></a> </p>
<table border="0" align="center" cellpadding="10" cellspacing="0">
  <tr>
    <td width="440" class="main"><h1>AltServlet</h1>
    <p>AltServlet is a Java servlet that uses Mozilla's <a href="http://www.mozilla.org/rhino/">Rhino library</a> to create a platform for developing JavaScript-based web applications.</p>
      <p>It implements a solid module system that parallels Java's own package system,
        making it easy to write clean modular JavaScript code.</p>
      <p>The primary purpose is a basis for the the Alt Framework, but it is not limited
        to this.</p>
      <h2>Rationale</h2>
      <p>My original intention with the Alt Framework was to build on top of <a href="http://www.helma.org/">Helma Object Publisher</a>, a similar JavaScript web framework based on Java and Rhino, but I soon found it too limiting. </p>
      <p>As a challenge, I decided to see how difficult it would be to write a basic Java Servlet that could serve JavaScript files. After two days of coding, I had functional prototype (released as RhinoServlet v0.01 alpha).</p>
      <p>After fine tuning the module system for JavaScript, I decided to stick with it. </p>
      <h2>RhinoServlet Components</h2>
      <p>The RhinoServlet  package consists of three different components, the  RhinoServlet itself, the jetty-based HTTPServer, and Launcher.</p>
      <h3>cello.alt.servlet.RhinoServlet </h3>
      <p>This class extends <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServlet.html">HttpServlet</a> and provides all the necessary functionality of a Java Servlet to serve pages.</p>
      <p>It  currently (v0.02) contains two init parameters which can be used to configure RhinoServlet: </p>
      <dl>
        <dt>          <code>scriptpath </code></dt>
        <dd>The initial folder to add to the scriptpath. The scriptpath is used to find and load JavaScript modules/scripts.</dd>
        <dt><code>entryPoint</code></dt>
        <dd>The initial script to call to serve page requests (fully-qualified module/script name).  </dd>
      </dl>
      <h3>cello.alt.server.HTTPServer</h3>
      <p>This class uses <a href="http://jetty.mortbay.org/jetty6/">Jetty6</a> to run an HTTP server to serve RhinoServlet. </p>
      <h3>cello.alt.launcher.Launcher</h3>
      <p>This provides an automatic Jar Classloader for the HTTPServer, it is<br />
used to make the executable altlauncher.jar.</p>
      <h2>RhinoServlet Module System </h2>
      <p>The largest problem occured in how JavaScript files are loaded. By nature, JavaScript is not file based. It was originally intended to be loaded linearly in a web page, and little thought was given to how modules interact.</p>
      <p>JavaScript does not have much in the way of compile-time type checking. It does not care if a function you call actually exists until you try to call it. You can pretty much load things in any order until you are ready to use them. The only place where this gets complicated is when you try to inherit classes from one another. The class you try to inherit from must be loaded first.</p>
      <p>With those things in mind, I set out to design a module system for JavaScript that was simple to use but made it easy and intuitive to package code. </p>
      <h3>Module System Proposal : Java Packages </h3>
      <p>My initial thoughts were to create a system like Java's import/package system. </p>
      <p>Instead of .java files, you have .js files. Instead of packages, you have modules. Each module has to be in a folder, much like packages. So the 'alt.foo' module would be a path alt/foo/, and any .js files in that folder would be <em>scripts</em> (as opposed to classes) of that module.</p>
      <p>Each module is loaded in its module scope, so if you define a function Bar in the file alt/foo/Bar.js, it needs to be accessed by calling alt.foo.Bar from other scopes. </p>
      <p>This makes it painless to define JavaScript classes and package them in modules, you simply define them as top-level classes and put them in a module folder.</p>
      <h3>Usage </h3>
      <p>Using the module system is almost identical to Java's import.</p>
      <p> Instead of modifying Rhino to allow a custom JavaScript syntax, I decided to stick with a compatible method:</p>
      <pre>Rhino.require(&quot;alt.foo.Bar&quot;);</pre>
      <p>This code states that the script Bar from the alt.foo module must be loaded at this point. This can be read as, the current script depends on alt.foo.Bar. </p>
      <p>RhinoServlet will then check if the script has been loaded and up to date. If not, it will load, compile, and execute the script in its module scope. If it fails to load, compile, or execute, an exception will be thrown. </p>
      <p>If the Bar script defined a class named Bar (this is the recommended convention), then you can access it through its module path (this is where RhinoServlet diverges from Java):</p>
      <pre>var bar = new alt.foo.Bar();
</pre>
      <p>Pretty simple? As with any JavaScript, you can easily make class aliases so you do not need to write out the whole module path each time you instantiate a class:</p>
      <pre>var Bar = alt.foo.Bar;</pre>
      <h3>Advanced Usage: Wildcard Loading </h3>
      <p>There are a few extra features of the module system that can be used.</p>
      <p>In addition to including individual scripts, you can load all of the scripts in a particular module by using the wildcard script name:</p>
      <pre>Rhino.require(&quot;alt.foo.*&quot;); </pre>
      <p>This will attempt to include all scripts in a particular module. Caution should be used when including scripts in this manner, because it does not guarantee a particular script will actually be loaded.</p>
      <p>Like Java, this will not load scripts from sub-modules.   </p>
      <h3>Advanced Usage: Cascading Dependencies </h3>
      <p>When extend classes in 
      JavaScript, the code looks something like this:</p>
      <pre><span class="comment">// Foo.js </span>
function Foo() { ... }</pre>
      <pre><span class="comment">// Bar.js</span>
Rhino.require(&quot;Foo&quot;);
function Bar() { ... }
Bar.prototype = new Foo();</pre>
      <p>As you can see, the Bar.js file constructs a new Foo object to create 
        its prototype.  If you were then to go and modify Foo to add a function:</p>
      <pre><span class="comment">// Foo.js </span>
function Foo() { ... }
Foo.prototype.sbu = function() { ... }</pre>
      <p>RhinoServlet would recognize that Foo was modified and reload it, but Bar would still be pointing at the old Foo, the Foo that is missing the sbu() function.</p>
      <p>To solve this issue, one would generally need to restart the server, but RhinoServlet provides &quot;cascading dependencies&quot; to solve the issue. </p>
      <pre><span class="comment">// Bar.js</span>
...
Rhino.require(&quot;Foo&quot;, true);
...</pre>
      <p>The second (optional) argument of the Rhino.require function specifies whether a file should be considered a cascading dependency.</p>
      <p>This tells RhinoServlet that Bar needs to also be reloaded whenever Foo is reloaded. (If this feature were enabled by default, then every single script would be reloaded every time one script is modified.) </p>
      <h2>HttpServlet </h2>
      <p>The purpose of the Alt Framework is not to reinvent the wheel (which on the surface seems hypocritical). As such, RhinoServlet is based on the robust <a href="http://java.sun.com/products/servlet/">Java Servlet technology</a>. </p>
      <p>Aside from the module system for loading JavaScript files and resources, RhinoServlet provides a transparent interface to the Java Servlet functions.</p>
      <p>With every page request made to RhinoServlet, a module is evaluated in its own scope. This scope has two variables, request and response, which are simply the Java objects, <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a> and <a href="http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpServletResponse.html">HttpServletResponse</a>, respectively. </p>
      <p>Thanks to Rhino's automatic Java wrapping, any Java object can be used in JavaScript as if it were a native JavaScript object.  </p>
      <h2>Scripting in RhinoServlet</h2>
      <p>Rhino provides an interesting mix of Java and JavaScript.  While you can write
        pure JavaScript with RhinoServlet, the true power (and more or less a 
      requirement) lies in using its ability to script Java.</p>
      <p>Rhino makes all Java classes and functions transparent in JavaScript, and in
        almost all cases, you can simply write Java code verbatim in JavaScript.  To 
        access classes you can either use the Packages class (or its global &quot;java&quot; 
      package):</p>
      <pre>var d = new java.awt.Dimension(100,200);</pre>
      <p>Or you can make aliases:</p>
      <pre>var Dimension = java.awt.Dimension;
var d = new Dimension(100,200);</pre>
      <p>You can methods and access member variables just as you would in Java:</p>
      <pre>var area = d.width * d.height;
d.setSize(800,600);</pre>
      <p>In addition to regular syntax, Rhino adds a few convenience features for bean-
        style access.  For example, if a class defines methods such as getXxx and 
      setXxx, you can access them like member variables.</p>
      <pre>var url = new java.net.URL(&quot;http://marcello.cellosoft.com/&quot;);
var port = url.port; <span class="comment">// same as url.getPort()</span></pre>
      <p>Useful links:</p>
      <ul>
        <li><a href="http://www.mozilla.org/rhino/ScriptingJava.html">Rhino's tutorial on Scripting Java          </a></li>
        <li><a href="http://developer.mozilla.org/en/docs/JavaScript">JavaScript Reference and Documentation</a></li>
        <li><a href="http://java.sun.com/docs/books/tutorial/">The Java Tutorial</a></li>
        <li><a href="http://java.sun.com/j2se/1.5.0/docs/api/">Java API Documentation</a>  </li>
        <li><a href="http://java.sun.com/javaee/5/docs/api/">Java EE/Servlets API documentation </a> </li>
      </ul>
      <h2>RhinoServlet Dynamic Scope</h2>
      <p>RhinoServlet implements dynamic scope.  This means allows modules to be defined
      in their own scope and for separate requests to each have their own scope.</p>
      <p>This can be illustrated as follows:<br />
        <img src="http://images.cellosoft.com/marcello/projects/alt/scopes.png" alt="RhinoServlet Scopes" width="440" height="239" /></p>
      <p>You can read any variable from a parent scope as if it were a local variable, but any variable or function you define will be defined in the current scope.
        This will shadow any variable or function in a higher scope, but not 
        replace them.</p>
      <p>You can access the global scope directly with the <code>global</code> variable. </p>
      <p>You can access modules by writing <code>module.submodule</code>. Submodule scopes are not children of their parent modules, so a script in foo.bar cannot access definitions in the foo module without prefixing them with <code>foo.</code>. </p>
      <p><a href="http://www.mozilla.org/rhino/scopes.html">More about Rhino's dynamic scope feature </a> </p>
    </td>
    <td valign="top"><ul class="menu">
        <li><a href="about.html">About</a></li>
      <li><a href="download.html">Download</a></li>
      <li><a href="documentation.html">Documentation</a></li>
      <li><a href="contribute.html">Contribute</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul></td>
  </tr>
</table>
<p align="right"><a href="http://www.cellosoft.com/"><img name="copyright" src="http://images.cellosoft.com/marcello/projects/alt/copyright.png" width="319" height="19" border="0" id="copyright" alt="copyright © 2006 cellosoft" /></a></p>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/layout.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<!-- InstanceBeginEditable name="doctitle" -->
<title>Cellosoft Alt Framework : Onion ML</title>
<!-- InstanceEndEditable -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="style.css" rel="stylesheet" type="text/css" />
<!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
</head>
<body bgcolor="#ffffff">
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="./"><img src="images/logo.png" width="481" height="119" border="0" id="logo" alt="cellosoft Alt : the Alternative web framework" /></a> </p>
<table width="780" border="0" align="center" cellpadding="10" cellspacing="0">
  <tr>
    <td width="540" valign="top" class="main"><!-- InstanceBeginEditable name="body" -->
      <h1>Onion ML</h1>
      <p>Onion ML is an XML template system designed with a bias toward modularity.</p>
      <p>Onion ML lets you easily custom XML tags to make modular content design simple and easy to mix with HTML. It is somewhat comparable to XSLT and JSF, but intended to be easier to understand.</p>
      <p>You define custom tags either as markup in XML files or as custom JavaScript functions which generate output.</p>
      <p>Onion ML also provides several control flow methods necessary for dynamic content. Methods for iterating over data sets and conditionally displaying tags are core to Onion ML's functionality.</p>
      <h2>Introduction to Onion ML</h2>
      <p>Onion ML is a meta syntax language for XML/HTML. At its core it allows you to define XML tags, and as a result, define layouts, templates, widgets, and so on.</p>
      <p>For example, to define a tag, you would write:</p>
      <pre>&lt;tag:mytag&gt;This is &lt;i&gt;my&lt;/i&gt; tag.&lt;/tag:mytag&gt;</pre>
      <p>Then if you were to use this tag somewhere, for example:</p>
      <pre>&lt;p&gt;Check out my tag: &lt;mytag/&gt;&lt;/p&gt;</pre>
      <p>It would be rendered as:</p>
      <pre>&lt;p&gt;Check out my tag: This is &lt;i&gt;my&lt;/i&gt; tag.&lt;/p&gt;
</pre>
      <p>Because you can use tags with-in tags, the power increase. For example, if you wanted to make a web-site layout, you might write the tag:</p>
      <pre>&lt;tag:mylayout&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;&lt;arg:title/&gt;&lt;/title&gt;
  &lt;style&gt; ... &lt;/style&gt;
 &lt;/head&gt;
 &lt;body&gt;<br />  &lt;h1&gt;&lt;arg:title/&gt;&lt;/h1&gt;
  &lt;div id=&quot;contents&quot;&gt;&lt;arg:body/&gt;&lt;/div&gt;
  &lt;div id=&quot;footer&quot;&gt;&lt;copyright&gt;&lt;arg:year/&gt;&lt;/copyright&gt;&lt;/div&gt;
 &lt;/body&gt;
&lt;/html&gt;
&lt;/tag:mylayout&gt;

&lt;tag:copyright&gt;Copyright &lt;arg:all/&gt; All rights reserved&lt;/tag:copyright&gt;</pre>
      <p>Now, to use this tag, you might have a page that looks like:</p>
      <pre>&lt;mylayout&gt;
 &lt;title&gt;Hello world!&lt;/title&gt;
 &lt;body&gt;This is my &lt;b&gt;world&lt;/b&gt;, too.&lt;/body&gt;
 &lt;year&gt;2008&lt;/year&gt;
&lt;/mylayout&gt;</pre>
      <p>This would be rendered as:</p>
      <pre>&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Hello world!&lt;/title&gt;
  &lt;style&gt; ... &lt;/style&gt;
 &lt;/head&gt;
 &lt;body&gt;<br />  &lt;h1&gt;Hello world!&lt;/h1&gt;
  &lt;div id=&quot;contents&quot;&gt;This is my &lt;b&gt;world&lt;/b&gt;, too.&lt;/div&gt;
  &lt;div id=&quot;footer&quot;&gt;Copyright 2008 All rights reserved&lt;/div&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>
      <p>Congratulations! You have now successfully separated your content from your layout! Let us try to understand what's happening.</p>
      <p><code>&lt;tag:mylayout&gt;...&lt;/tag:mylayout&gt;</code> defines a tag  that can be used anywhere. It contains both HTML and special OnionML tags. The <code>&lt;arg:title/&gt;</code> tag inside the mylayout tag allows you to use arguments to your tag (notice how the title is placed in both the html <code>&lt;title&gt;</code> and <code>&lt;h1&gt;</code> tags). </p>
      <p>By separating <code>&lt;tag:footer&gt;</code> as a separate tag, it can now be used in other tags. The special <code>&lt;arg:all/&gt;</code> argument matches the entire contents passed to the tag.<br>
      </p>
      <h2>Tags</h2>
      <p>Tags are simply defined as <code>&lt;tag:name&gt; ... &lt;/tag:name&gt;</code>. This specifies a tag with the name &quot;name.&quot;</p>
      <p>Within tags you can reference any other tag. If it does not exist, it will be used as-is. </p>
      <h2>Attributes</h2>
      <p>You can set attributes with the special &lt;set:attribute&gt; tag. For example:</p>
      <pre>&lt;tag:link&gt;
 &lt;a&gt;&lt;set:href&gt;&lt;arg:url/&gt;&lt;/set:href&gt;&lt;arg:name/&gt;&lt;/a&gt;
&lt;/tag:link&gt;</pre>
      <p>This could then be used like so:<br>
      </p>
      <pre>&lt;link&gt;
 &lt;url&gt;http://alt.cellosoft.com/&lt;/url&gt;
 &lt;name&gt;Alt website&lt;/name&gt;
&lt;/link&gt;</pre>
      <p>      Arguments can be passed as tags or attributes, for example, the following is equivalent short-hand for the four lines above:</p>
      <pre>&lt;link url=&quot;http://alt.cellosoft.com/&quot; name=&quot;Alt website&quot;/&gt;
</pre>
      <p>If both an attribute and child tag are specified, behavior is undefined.</p>
      <p>Both of the examples above will evaluate to:</p>
      <pre>&lt;a href=&quot;http://alt.cellosoft.com/&quot;&gt;Alt website&lt;/a&gt;</pre>
      <h2>Processing Data [under construction]</h2>
      <p>Data is an important part of a template engine. While the XML format does not allow for logic, several special tags are defined to conditionally display content. For example, to display a list of users, you may do something like:</p>
      <pre>&lt;if data=&quot;users&quot;&gt;
 &lt;table&gt;

  &lt;for item=&quot;user&quot; data=&quot;users&quot;&gt;
   &lt;tr&gt;
    &lt;td&gt;&lt;get data=&quot;user.name&quot;/&gt;&lt;/td&gt; 
    &lt;td&gt;&lt;get data=&quot;user.email/&gt;&lt;/td&gt;
    &lt;td&gt;&lt;date&gt;&lt;get data=&quot;user.registerDate&quot;/&gt;&lt;/date&gt;&lt;/td&gt;
   &lt;/tr&gt;

  &lt;/for&gt;
 &lt;/table&gt;

 &lt;else&gt;No users found.&lt;/else&gt;

&lt;/if&gt;
</pre>
      <p>This demonstrates all three special tags: for, if, and else. </p>
      <p>[Note: I am undecided on the syntax for these tags. I am also considering the idea of an alternative shorthand syntax (currently not supported):]</p>
      <pre>&lt;table o:if=&quot;users&quot;&gt;
 &lt;tr o:for=&quot;user&quot; o:data=&quot;users&quot;&gt;
  &lt;td&gt;&lt;data get=&quot;user.name&quot;/&gt;&lt;/td&gt; 
  &lt;td&gt;&lt;data get=&quot;user.email&quot;/&gt;&lt;/td&gt;
  &lt;td&gt;&lt;date&gt;&lt;data get=&quot;user.registerDate&quot;/&gt;&lt;/date&gt;&lt;/td&gt;
 &lt;/tr&gt;
&lt;/table&gt;

&lt;if data=&quot;!users&quot;&gt;No users found.&lt;/if&gt;</pre>
<h2>Onion ML in the Alt Framework</h2>
      <p>To use Onion ML in JavaScript you first make an OnionML object with  XML:</p>
      <pre>var onion = new Onion(
 &lt;onion&gt; 
  &lt;tag:mytag&gt;woot, &lt;arg:all/&gt;!&lt;/tag:mytag&gt; 
 &lt;/onion&gt;
);

onion.add(
 &lt;tag:anothertag&gt;play the &lt;mytag&gt;tuba&lt;/mytag&gt;&lt;/tag:anothertag&gt;
);      </pre>
      <p>Then you can use that object to evaluate tags:</p>
      <pre>var output = onion.evaluate(&lt;mytag&gt;ice cream&lt;/mytag&gt;);
</pre>
      <p>The output is XML, so if you want to print it to the screen, write:</p>
      <pre>response.write(onion.evaluate(&lt;mytag&gt;&lt;b&gt;ice cream&lt;/b&gt;&lt;/mytag&gt;).toXMLString());</pre>
      <p>You  pass variables as an optional second argument:</p>
      <pre>onion.evaluate(&lt;mytag/&gt;, { name: &quot;Onion Man&quot; });</pre>
<h2>Functional Tags </h2>
      <p>You can specify tags as functions in JavaScript:</p>
      <pre>var onion = new Onion;


onion.add(&quot;date&quot;, function() {
  return new Date().toString()
});

onion.add({
 multiply: function(onion,xml) { return contents.x * contents.y; },
 repeat: function(onion,xml) {
  var result = &lt;&gt;&lt;/&gt;;
  for (var i=0; i&lt;xml.count; i++)
   result += onion.evaluateChildren(xml.body);
  return result;
 }

});
</pre>
      <p>These functions take an optional XML object with the entire XML tag and contents and should return a new XML object. <strong>Important Note:</strong> by design the contents are not automatically evaluate. You can evaluate contents with the provided Onion.evaluate and Onion.evaluateChildren methods.</p>
      <h2>Advanced Functional Tags</h2>
      <p>Functional tags give you a surprising amount of power for very little code, for example, one could write an import tag for loading in other xml files with tags (usage: &lt;import file=&quot;foo.xml&quot;/&gt;):</p>
      <pre>onion.add(&quot;import&quot;, function(onion,xml) {
   onion.add(XML.read(<a href="mailto:xml.@filename">xml.@filename</a>));
   return &lt;&gt;&lt;/&gt;; 
});
</pre>
      <p>Or the data processing outlined above could be implemented as:</p>
      <pre><span class="comment">
// this translates getItem({foo:{bar:1}},&quot;foo.bar&quot; to 1</span>
function getItem(data,path) {
  var path = path.toString().split(/\./);
  while (path.length)
    data = data[path.shift()];
  return data;
}
onion.add({
  get:   function(onion,xml,data) {
           return getItem(data, xml.@data);
         },
  &quot;if&quot;:  function(onion,xml,data) {
           if (getItem(data,xml.@data)) {
             delete xml['else'];
             return onion.evaluateChildren(xml).children();
           } else
             return onion.evaluateChildren(xml['else']).children();
         },
  &quot;for&quot;: function(onion,xml,data) {
           var result = &lt;&gt;&lt;/&gt;;
           for each (var item in getItem(data,xml.@data)) {
             data[xml.@item] = item;
             result += onion.evaluateChildren(xml.copy(),data).children();
           }
           return result;
         }
});</pre>
      <h2>Engine Background</h2>
      <p>Onion ML was designed so that it has very few moving parts. In fact, all tags are  simply standard functional tags.</p>
      <p>Generic  tags are  defined as a functional tag that call Onion.evaluateChildren:</p>
      <pre>Onion.prototype.getTagFunction = function(tag) {
  <span class="comment">// return tag if it is defined</span>
  if (this.tags[tag])
    return this.tags[tag];
  <span class="comment">// otherwise return generic function</span>

  return function(onion, xml, data) {
    return onion.evaluateChildren(xml,data);
  }
}</pre>
      <p>Onion.evaluateChildren:</p>
      <pre>Onion.prototype.evaluateChildren = function (xml, data) {<br />    if (xml instanceof XML)<br />    <span class="comment">    // recursively call evaluate on child elements. </span><br />        for each (var child in xml.*)<br />            if (child.nodeKind)<br />                if (child.nodeKind() == 'element') <br />                    Onion.replaceWith(child, this.evaluate(child, data));<br />    return xml;<br />}</pre>
<p>Onion.evaluate is defined as:</p>
      <pre>Onion.prototype.evaluate = function(xml, data) {
 <span class="comment">// get the associated tag function and call it</span>
 return (this.getTagFunction(xml.localName()))(this,xml,data);
}</pre>
      <p>XML-defined tags are defined as (args is an array of args used, tagxml is the XML of the tag):</p>
      <pre>function(onion, xml, data) {<br /><span class="comment">    // copy the tag template XML</span><br />    var result = tagxml.copy();<br />    <br /><span class="comment">    // Replace all &lt;arg:*/&gt; with the passed arguments</span><br />    var ARG = Onion.ARG;<br />    for each (var node in result..ARG::*) {<br />        var arg = node.localName();<br /><span class="comment">        // &lt;arg:all/&gt; returns everything, otherwise look for an attribute <br />        // or child node</span><br />        var tagValue = arg==&quot;all&quot; <br />                        ? xml.children() <br />                        : (xml.@[arg].toString() || xml[arg].children());<br />        Onion.replaceWith(node, tagValue);<br />    }<br /><span class="comment">    // Evaluate all children then knock off the top-level</span><br />    return onion.evaluateChildren(result, data).children();<br />}</pre>
      <p>E4X does not support &quot;replaceWith&quot; so we wrote this helper function:</p>
      <pre>Onion.replaceWith = function(node,newnode) {<br />    node.parent().replace(node.childIndex(), newnode);<br />}</pre>
    <!-- InstanceEndEditable --></td>
    <td rowspan="2" valign="top"><ul class="menu">
        <li><a href="./">About</a></li>
      <li><a href="download.html">Download</a></li>
      <li><a href="documentation.html">Documentation</a></li>
      <li><a href="contribute.html">Contribute</a><br />
        <a href="license.html">License</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul></td>
  </tr>
  <tr>
    <td align="right" valign="top" class="small">page last updated: 
    <!-- #BeginDate format:fcAm1 -->Saturday, February 16, 2008<!-- #EndDate --></td>
  </tr>
</table>
<p align="right"><a href="http://www.cellosoft.com/"><img src="images/copyright.png" width="319" height="19" border="0" id="copyright" alt="copyright © 2006 cellosoft" /></a></p>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-500492-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body>
<!-- InstanceEnd --></html>

<?xml version="1.0"?>
<schema
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="squeal.xsd"> 
<types>
 <description>
  Defines some basic types
 </description>

 <type name="username" base="sql:char(15)">
  <constrain type="length" min="3" max="15"/>
  <constrain type="ereg" value="^[a-zA-Z0-9]+$"/>
 </type>
 <type name="password" base="sql:char(10)">
  <constrain type="length" min="6" max="15"/>
  <constrain type="ereg" value="^[a-zA-Z0-9]+$"/>
 </type>
 <type name="email" base="sql:char(255)">
  <constrain type="length" min="5" max="255"/>
  <constrain type="ereg" value="^.+@.+$"/>
 </type>
 <type name="string" base="sql:varchar(255)" /> 
 
 <type name="title" base="string" default="'No title'" />
 <type name="message" base="sql:text" />
 <type name="date" base="sql:datetime">
   <value name="default" value="sql:NOW()" />
   <value name="yesterday" value="sql:DATE_SUB(NOW(),INTERVAL 1 DAY)" />
 </type>
</types>

<database name="network"> 

 <table name="user">
  <field name="username" type="username" index="unique" required="true" />
  <field name="password" type="password" required="true" />
  <field name="email" type="email" index="true" required="true" />
  <field name="reg" type="date" required="true" />
  <field name="access" type="date" />
 </table>
 <table name="memo">
  <link name="recipient" table="user" index="true" required="true" />
  <link name="sender" table="user" index="true" required="false" />
  <field name="date" type="date" required="true" />
  <field name="status" type="enum">
   <option name="Unread"  value="unread" />
   <option name="Read"    value="read"   />
   <option name="Replied" value="replied"/>
  </field>
  <field name="subject" type="title" />
  <field name="body" type="message" />
 </table>

</database>

<database name="forum">

	<type name="boolean" base="sql:tinyint" default="0" />
 <table name="thread">
  <link name="author" table="network.user" index="true" />
  <field name="date" type="date" />
  <field name="subject" type="title" required="true" index="fulltext" />
  
  <table name="description" unique="true">
   <field name="description" type="message" index="fulltext" /> 
  </table>
  
  
      
  <table name="personal">
   <link name="user" table="network.user" index="unique" />
   <field name="read" type="boolean" />
  </table>
      
  <view name="recent">
   <param name="perPage" type="integer" />
   <param name="currentUser" type="member" required="false" />
  <!-- <link name="" table="personal" on="`member`=$currentUser" /> -->
  </view>
 
  <table name="comment">
   <link name="author" table="network.user" index="true" />
   <field name="date" type="date" />
   <field name="body" type="message" index="fulltext" />
   
   <table name="vote">
    <link name="user" table="network.user" index="unique" />
    <field name="favorite" type="boolean" required="true" />
   </table>
   
  </table>

 </table>
 
 <table name="node">
  <link name="parent" table="node" index="true" />
  <field name="author" type="network.user" index="true" />
  <field name="title" type="title" required="true" index="fulltext" />
  <field name="body" type="message" required="true" index="fulltext" />
 </table>
</database>

	
</schema>